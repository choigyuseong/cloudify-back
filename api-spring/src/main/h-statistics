// ==================== í†µê³„ ====================

app.get('/db-stats', async (req, res) => {
  const access_token = req.query.access_token;

  try {
    const totalTracks = await pool.query('SELECT COUNT(*) as count FROM tracks');
    const totalArtists = await pool.query('SELECT COUNT(DISTINCT artist_id) as count FROM tracks');
    const topArtists = await pool.query(`
      SELECT artist_name, COUNT(*) as track_count
      FROM tracks GROUP BY artist_name ORDER BY track_count DESC LIMIT 10
    `);

    res.send(`
      <!DOCTYPE html>
      <html>
      <head><meta charset="UTF-8"><title>í†µê³„</title>
      <style>
        body { font-family: Arial; max-width: 1200px; margin: 50px auto; padding: 20px; }
        .stat-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; margin: 30px 0; }
        .stat-card { background: #f8f9fa; padding: 20px; border-radius: 10px; text-align: center; }
        .stat-number { font-size: 48px; font-weight: bold; color: #1DB954; }
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 12px; border-bottom: 1px solid #ddd; }
        th { background: #1DB954; color: white; }
      </style>
      </head>
      <body>
        <h1>ğŸ“ˆ ë°ì´í„°ë² ì´ìŠ¤ í†µê³„</h1>
        <div class="stat-grid">
          <div class="stat-card">
            <div class="stat-number">${totalTracks.rows[0].count}</div>
            <div>ì´ ê³¡ ìˆ˜</div>
          </div>
          <div class="stat-card">
            <div class="stat-number">${totalArtists.rows[0].count}</div>
            <div>ì´ ì•„í‹°ìŠ¤íŠ¸</div>
          </div>
        </div>
        <h2>ğŸ¤ TOP 10 ì•„í‹°ìŠ¤íŠ¸</h2>
        <table>
          <tr><th>ìˆœìœ„</th><th>ì•„í‹°ìŠ¤íŠ¸</th><th>ê³¡ ìˆ˜</th></tr>
          ${topArtists.rows.map((a, i) => `<tr><td>${i+1}</td><td>${a.artist_name}</td><td>${a.track_count}</td></tr>`).join('')}
        </table>
        <a href="/dashboard?access_token=${access_token}">â† ëŒ€ì‹œë³´ë“œ</a>
      </body>
      </html>
    `);
  } catch (error) {
    res.send('í†µê³„ ì¡°íšŒ ì‹¤íŒ¨: ' + error.message);
  }
});

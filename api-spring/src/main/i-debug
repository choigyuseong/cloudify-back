// ==================== ë””ë²„ê·¸ ====================

app.get('/debug-tags', async (req, res) => {
  try {
    const tagsResult = await pool.query('SELECT COUNT(*) as count FROM tags');
    const tagsCount = tagsResult.rows[0].count;

    const audioResult = await pool.query('SELECT COUNT(*) as count FROM audio_features');
    const audioCount = audioResult.rows[0].count;

    const sampleTrack = await pool.query(`
      SELECT t.name, t.artist_name, af.tempo, af.energy, af.valence
      FROM tracks t
      LEFT JOIN audio_features af ON t.id = af.track_id
      LIMIT 1
    `);

    const sampleTags = await pool.query(`
      SELECT track_id, tag_type, tag_value
      FROM tags
      LIMIT 10
    `);

    res.send(`
      <!DOCTYPE html>
      <html>
      <head><meta charset="UTF-8"><title>ë””ë²„ê·¸</title></head>
      <body style="font-family: Arial; max-width: 1000px; margin: 50px auto; padding: 20px;">
        <h1>ğŸ” ë””ë²„ê·¸ ì •ë³´</h1>
        <h2>ë°ì´í„° ê°œìˆ˜:</h2>
        <ul>
          <li>Audio Features: ${audioCount}ê°œ</li>
          <li>Tags: ${tagsCount}ê°œ</li>
        </ul>
        
        <h2>ìƒ˜í”Œ íŠ¸ë™:</h2>
        <pre>${JSON.stringify(sampleTrack.rows, null, 2)}</pre>

        <h2>ìƒ˜í”Œ íƒœê·¸ (ìµœëŒ€ 10ê°œ):</h2>
        <pre>${JSON.stringify(sampleTags.rows, null, 2)}</pre>

        <a href="/dashboard?access_token=${req.query.access_token}">â† ëŒ€ì‹œë³´ë“œ</a>
      </body>
      </html>
    `);
  } catch (error) {
    res.send('ì—ëŸ¬: ' + error.message);
  }
});
